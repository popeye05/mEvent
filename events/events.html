<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Events - College Event Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

<header>
    <h1>College Event Manager</h1>
    <div class="user" id="logoutBtn">Participant â–¾</div>
</header>

<div class="main">
    <div class="page-title">Upcoming Events</div>
    <div class="events-grid" id="eventsGrid">
        <!-- Events will load here -->
    </div>
</div>

<footer>Â© 2025 College Event Manager | Contact | Privacy | Terms</footer>

<script type="module">
import { auth, db } from "../js/firebase-config.js";
import { logoutUser } from "../js/auth.js";
import { collection, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.2.0/firebase-firestore.js";

document.getElementById("logoutBtn").addEventListener("click", logoutUser);

async function loadEvents() {
    const user = auth.currentUser;
    if(!user) return window.location.href = "../login/login.html";

    const grid = document.getElementById("eventsGrid");
    grid.innerHTML = "Loading...";

    const snapshot = await getDocs(collection(db, "events"));
    grid.innerHTML = "";
    snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const card = document.createElement("div");
        card.className = "event-card";
        card.innerHTML = `
            <div class="event-title">${data.name}</div>
            <div class="event-date">ðŸ“… ${data.date}</div>
            <div class="event-desc">${data.description}</div>
            <button class="btn" onclick="registerEvent('${docSnap.id}', '${data.name}', '${data.date}')">Register</button>
        `;
        grid.appendChild(card);
    });
}

window.registerEvent = async (id, name, date) => {
    const user = auth.currentUser;
    if(!user) return alert("Login required");

    const regRef = doc(db, "registrations", ${user.uid}_${id});
    await setDoc(regRef, {
        participantId: user.uid,
        eventId: id,
        eventName: name,
        date: date,
        status: "Registered"
    });

    alert("Registered successfully!");
};

auth.onAuthStateChanged(user => {
    if(user) loadEvents();
    else window.location.href = "../login/login.html";
});
</script>

</body>
</html>